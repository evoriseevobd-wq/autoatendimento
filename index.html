<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Card√°pio</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --cream: #faf8f4;
      --cream2: #f2ede6;
      --white: #ffffff;
      --ink: #1a1814;
      --ink2: #3d3a35;
      --muted: #9a9590;
      --border: #e4dfd8;
      --border-dk: #ccc7bf;
      --amber: #c8a165;
      --radius: 18px;
      --radius-sm: 12px;
      --shadow: 0 1px 8px rgba(26,24,20,0.06);
      --shadow-lg: 0 8px 32px rgba(26,24,20,0.12);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }

    body {
      font-family: 'Outfit', sans-serif;
      background: var(--cream);
      color: var(--ink);
      min-height: 100vh;
      padding-bottom: 120px;
    }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    .header {
      background: var(--white);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .header-inner {
      max-width: 700px;
      margin: 0 auto;
      padding: 20px 24px 16px;
    }
    .restaurant-name {
      font-family: 'Cormorant Garamond', serif;
      font-size: 32px;
      font-weight: 700;
      letter-spacing: -0.02em;
      color: var(--ink);
      line-height: 1.05;
    }
    .mesa-pill {
      display: none;
      align-items: center;
      gap: 6px;
      margin-top: 8px;
      background: var(--ink);
      color: #fff;
      border-radius: 999px;
      padding: 5px 14px 5px 10px;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.04em;
      width: fit-content;
    }
    .mesa-pill .dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--amber);
      animation: blink 2s ease infinite;
    }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

    /* ‚îÄ‚îÄ CAT NAV ‚îÄ‚îÄ */
    .cat-nav-wrap {
      background: var(--white);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 85px;
      z-index: 90;
    }
    .cat-nav {
      max-width: 700px;
      margin: 0 auto;
      display: flex;
      gap: 4px;
      padding: 10px 24px;
      overflow-x: auto;
      scrollbar-width: none;
    }
    .cat-nav::-webkit-scrollbar { display: none; }
    .cat-btn {
      flex-shrink: 0;
      padding: 6px 18px;
      border-radius: 999px;
      border: 1.5px solid var(--border-dk);
      background: transparent;
      color: var(--muted);
      font-size: 12.5px;
      font-weight: 600;
      font-family: 'Outfit', sans-serif;
      cursor: pointer;
      transition: all 0.18s ease;
      white-space: nowrap;
    }
    .cat-btn:hover { color: var(--ink); border-color: var(--ink); }
    .cat-btn.active { background: var(--ink); border-color: var(--ink); color: #fff; }

    /* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
    .main { max-width: 700px; margin: 0 auto; padding: 32px 24px 40px; }

    /* ‚îÄ‚îÄ STATES ‚îÄ‚îÄ */
    .state-box {
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      min-height: 45vh; gap: 14px; text-align: center;
    }
    .spinner {
      width: 32px; height: 32px;
      border: 2px solid var(--border);
      border-top-color: var(--amber);
      border-radius: 50%;
      animation: spin 0.75s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .state-box p { font-size: 14px; color: var(--muted); }
    .state-box .icon { font-size: 36px; }

    /* ‚îÄ‚îÄ CATEGORY ACCORDION ‚îÄ‚îÄ */
    .category-section {
      margin-bottom: 4px;
      animation: fadeUp 0.4s ease both;
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(14px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .category-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 22px;
      font-weight: 600;
      font-style: italic;
      color: var(--ink);
      display: flex;
      align-items: center;
      gap: 10px;
      letter-spacing: -0.01em;
      cursor: pointer;
      padding: 16px 0 14px;
      user-select: none;
      border-bottom: 1.5px solid var(--border);
    }
    .category-title-text { flex: 1; }
    .category-arrow {
      font-size: 11px;
      color: var(--muted);
      transition: transform 0.28s cubic-bezier(0.4,0,0.2,1);
      flex-shrink: 0;
    }
    .category-section.open .category-arrow { transform: rotate(90deg); }
    .items-grid {
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow: hidden;
      max-height: 0;
      opacity: 0;
      transition: max-height 0.4s ease, opacity 0.3s ease, padding-top 0.3s ease;
      padding-top: 0;
    }
    .category-section.open .items-grid {
      max-height: 3000px;
      opacity: 1;
      padding-top: 12px;
    }

    /* ‚îÄ‚îÄ ITEM CARD ‚îÄ‚îÄ */
    .item-card {
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: var(--shadow);
      overflow: hidden;
      margin-bottom: 2px;
    }
    .item-card:hover { border-color: var(--border-dk); box-shadow: var(--shadow-lg); transform: translateY(-1px); }
    .item-card.inactive { opacity: 0.4; pointer-events: none; }
    .item-img-wrap { width: 90px; height: 90px; flex-shrink: 0; overflow: hidden; }
    .item-img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .item-img-placeholder {
      width: 90px; height: 90px; flex-shrink: 0;
      background: var(--cream2);
      display: flex; align-items: center; justify-content: center;
      font-size: 26px; color: var(--border-dk);
    }
    .item-info { flex: 1; min-width: 0; padding: 14px 14px 14px 16px; }
    .item-name { font-weight: 600; font-size: 14.5px; color: var(--ink); margin-bottom: 3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .item-desc { font-size: 12.5px; color: var(--muted); line-height: 1.45; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; font-weight: 300; }
    .item-footer { display: flex; align-items: center; justify-content: space-between; margin-top: 10px; }
    .item-price { font-family: 'Cormorant Garamond', serif; font-size: 18px; font-weight: 700; color: var(--ink); }
    .item-inactive-tag { font-size: 10.5px; font-weight: 500; color: var(--muted); text-transform: uppercase; }
    .add-btn {
      width: 32px; height: 32px; border-radius: 50%; border: none;
      background: var(--ink); color: #fff; font-size: 20px;
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      flex-shrink: 0; transition: all 0.18s ease;
      box-shadow: 0 2px 8px rgba(26,24,20,0.2);
    }
    .add-btn:hover { background: var(--amber); transform: scale(1.1); }
    .item-counter { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }
    .counter-btn {
      width: 28px; height: 28px; border-radius: 50%;
      border: 1.5px solid var(--border-dk); background: transparent;
      color: var(--ink); font-size: 16px; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.15s ease; font-weight: 600;
    }
    .counter-btn:hover { background: var(--ink); border-color: var(--ink); color: #fff; }
    .counter-qty { font-size: 14px; font-weight: 700; min-width: 18px; text-align: center; }

    /* ‚îÄ‚îÄ CART FAB ‚îÄ‚îÄ */
    .cart-fab {
      position: fixed; bottom: 24px; left: 50%;
      transform: translateX(-50%); z-index: 200;
      background: var(--ink); color: #fff; border: none;
      border-radius: 999px; padding: 15px 24px;
      font-family: 'Outfit', sans-serif; font-size: 14px; font-weight: 600;
      cursor: pointer; display: flex; align-items: center; gap: 10px;
      box-shadow: 0 8px 28px rgba(26,24,20,0.28);
      transition: all 0.22s ease; white-space: nowrap;
      min-width: 260px; justify-content: space-between;
    }
    .cart-fab:hover { transform: translateX(-50%) translateY(-2px); }
    .cart-fab.hidden { display: none; }
    .cart-fab-left { display: flex; align-items: center; gap: 10px; }
    .cart-count-badge { background: var(--amber); border-radius: 999px; padding: 2px 9px; font-size: 12.5px; font-weight: 700; color: #fff; }
    .cart-fab-price { font-family: 'Cormorant Garamond', serif; font-size: 17px; font-weight: 700; }

    /* ‚îÄ‚îÄ DRAWERS ‚îÄ‚îÄ */
    .cart-backdrop, .checkout-backdrop {
      position: fixed; inset: 0;
      background: rgba(26,24,20,0.5);
      opacity: 0; pointer-events: none;
      transition: opacity 0.25s ease;
      backdrop-filter: blur(2px);
    }
    .cart-backdrop { z-index: 300; }
    .checkout-backdrop { z-index: 500; }
    .cart-backdrop.open, .checkout-backdrop.open { opacity: 1; pointer-events: auto; }

    .cart-drawer {
      position: fixed; bottom: 0; left: 0; right: 0; z-index: 400;
      background: var(--white); border-radius: 24px 24px 0 0;
      max-height: 82vh; display: flex; flex-direction: column;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.4,0,0.2,1);
      box-shadow: 0 -8px 48px rgba(26,24,20,0.18);
    }
    .cart-drawer.open { transform: translateY(0); }
    .cart-handle { width: 36px; height: 3px; background: var(--border-dk); border-radius: 999px; margin: 12px auto 0; flex-shrink: 0; }
    .cart-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 24px 14px; border-bottom: 1px solid var(--border); flex-shrink: 0; }
    .cart-title { font-family: 'Cormorant Garamond', serif; font-size: 24px; font-weight: 700; }
    .cart-close { width: 34px; height: 34px; border-radius: 50%; border: 1.5px solid var(--border-dk); background: transparent; color: var(--ink); font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s ease; }
    .cart-close:hover { background: var(--cream); }
    .cart-body { flex: 1; overflow-y: auto; padding: 16px 24px; }
    .cart-empty { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px; padding: 48px 0; color: var(--muted); }
    .cart-empty .icon { font-size: 36px; }
    .cart-empty p { font-size: 13px; }
    .cart-item { display: flex; align-items: center; gap: 12px; padding: 13px 0; border-bottom: 1px solid var(--border); }
    .cart-item:last-child { border-bottom: none; }
    .cart-item-name { flex: 1; font-size: 14px; font-weight: 600; }
    .cart-item-qty { display: flex; align-items: center; gap: 8px; }
    .cart-qty-btn { width: 26px; height: 26px; border-radius: 50%; border: 1.5px solid var(--border-dk); background: transparent; font-size: 15px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s ease; }
    .cart-qty-btn:hover { background: var(--ink); border-color: var(--ink); color: #fff; }
    .cart-qty-num { font-size: 14px; font-weight: 700; min-width: 16px; text-align: center; }
    .cart-item-price { font-family: 'Cormorant Garamond', serif; font-size: 16px; font-weight: 700; min-width: 70px; text-align: right; }
    .cart-footer { padding: 16px 24px 32px; border-top: 1px solid var(--border); flex-shrink: 0; }
    .cart-total-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .cart-total-label { font-size: 13px; font-weight: 500; color: var(--muted); }
    .cart-total-value { font-family: 'Cormorant Garamond', serif; font-size: 24px; font-weight: 700; }
    .checkout-btn { width: 100%; padding: 15px; border-radius: var(--radius-sm); border: none; background: var(--ink); color: #fff; font-family: 'Outfit', sans-serif; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.18s ease; }
    .checkout-btn:hover { background: #2d2a24; }

    /* ‚îÄ‚îÄ CHECKOUT MODAL ‚îÄ‚îÄ */
    .checkout-modal {
      position: fixed; bottom: 0; left: 0; right: 0; z-index: 600;
      background: var(--white); border-radius: 24px 24px 0 0;
      padding: 8px 24px 40px;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.4,0,0.2,1);
      box-shadow: 0 -8px 48px rgba(26,24,20,0.18);
      max-height: 92vh; overflow-y: auto;
    }
    .checkout-modal.open { transform: translateY(0); }
    .checkout-handle { width: 36px; height: 3px; background: var(--border-dk); border-radius: 999px; margin: 12px auto 20px; }
    .checkout-title { font-family: 'Cormorant Garamond', serif; font-size: 26px; font-weight: 700; margin-bottom: 20px; text-align: center; }
    .mesa-warning { background: var(--ink); color: #fff; border-radius: var(--radius-sm); padding: 13px 16px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; font-size: 13.5px; font-weight: 500; }
    .warn-icon { font-size: 20px; flex-shrink: 0; }
    .form-field { margin-bottom: 14px; }
    .form-label { display: block; font-size: 11px; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 7px; }
    .form-input, .form-select { width: 100%; padding: 13px 16px; border-radius: var(--radius-sm); border: 1.5px solid var(--border-dk); background: var(--cream); color: var(--ink); font-family: 'Outfit', sans-serif; font-size: 15px; font-weight: 400; outline: none; transition: border-color 0.18s ease, background 0.18s ease; appearance: none; }
    .form-input:focus, .form-select:focus { border-color: var(--ink); background: var(--white); }
    .form-input::placeholder { color: var(--border-dk); }
    .order-summary { background: var(--cream); border-radius: var(--radius-sm); padding: 14px 16px; margin-bottom: 16px; border: 1px solid var(--border); }
    .order-summary-title { font-size: 10.5px; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 10px; }
    .order-summary-item { display: flex; justify-content: space-between; align-items: center; font-size: 13px; color: var(--ink2); padding: 4px 0; }
    .order-summary-item span:last-child { font-weight: 600; }
    .order-summary-total { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border-dk); font-size: 15px; font-weight: 700; }
    .order-summary-total span:last-child { font-family: 'Cormorant Garamond', serif; font-size: 18px; }
    .confirm-btn { width: 100%; padding: 15px; border-radius: var(--radius-sm); border: none; background: var(--ink); color: #fff; font-family: 'Outfit', sans-serif; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.18s ease; margin-top: 8px; }
    .confirm-btn:disabled { opacity: 0.45; cursor: not-allowed; }
    .confirm-btn:hover:not(:disabled) { background: #2d2a24; }

    /* ‚îÄ‚îÄ SUCCESS ‚îÄ‚îÄ */
    .success-screen {
      position: fixed; inset: 0; background: var(--white); z-index: 700;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      gap: 14px; padding: 40px; text-align: center;
      transform: scale(0.94); opacity: 0; pointer-events: none;
      transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
    }
    .success-screen.open { transform: scale(1); opacity: 1; pointer-events: auto; }
    .success-icon-wrap { width: 80px; height: 80px; border-radius: 50%; border: 2px solid var(--ink); display: flex; align-items: center; justify-content: center; font-size: 32px; animation: popIn 0.45s cubic-bezier(0.4,0,0.2,1) 0.08s both; }
    @keyframes popIn { from{transform:scale(0);opacity:0} to{transform:scale(1);opacity:1} }
    .success-title { font-family: 'Cormorant Garamond', serif; font-size: 32px; font-weight: 700; }
    .success-msg { font-size: 14px; color: var(--muted); line-height: 1.65; max-width: 280px; font-weight: 300; }
    .success-order { font-size: 12px; font-weight: 700; background: var(--cream2); border: 1px solid var(--border-dk); border-radius: 999px; padding: 8px 24px; letter-spacing: 0.06em; text-transform: uppercase; }
    .success-divider { width: 40px; height: 1px; background: var(--border-dk); }
    .success-back-btn { margin-top: 4px; padding: 12px 28px; border-radius: 999px; border: 1.5px solid var(--border-dk); background: transparent; font-family: 'Outfit', sans-serif; font-size: 13px; font-weight: 500; color: var(--muted); cursor: pointer; transition: all 0.18s ease; }
    .success-back-btn:hover { color: var(--ink); border-color: var(--ink); }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       üî¶ SPOTLIGHT TUTORIAL
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .spotlight-overlay {
      position: fixed;
      inset: 0;
      z-index: 450;
      pointer-events: auto;
      background: rgba(10, 9, 8, 0.82);
      transition: opacity 0.4s ease;
    }
    .spotlight-overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }

    /* O "recorte" que ilumina a primeira categoria */
    .spotlight-hole {
      position: absolute;
      border-radius: 14px;
      box-shadow: 0 0 0 9999px rgba(10, 9, 8, 0.82);
      transition: all 0.3s ease;
      pointer-events: none;
    }

    .spotlight-label {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      z-index: 451;
      color: #fff;
      font-family: 'Outfit', sans-serif;
      font-size: 15px;
      font-weight: 500;
      text-align: center;
      pointer-events: none;
      line-height: 1.6;
      transition: opacity 0.4s ease;
      white-space: nowrap;
    }
    .spotlight-label.hidden { opacity: 0; }
    .spotlight-label .s-icon {
      display: block;
      font-size: 26px;
      margin-bottom: 6px;
      animation: bob 1.3s ease infinite;
    }
    @keyframes bob {
      0%,100% { transform: translateY(0); }
      50%      { transform: translateY(-5px); }
    }

    /* Toast passo 2 */
    .toast-card {
      position: fixed;
      bottom: 32px;
      left: 50%;
      transform: translateX(-50%) translateY(16px);
      z-index: 600;
      background: var(--ink);
      color: #fff;
      border-radius: 999px;
      padding: 13px 26px;
      font-family: 'Outfit', sans-serif;
      font-size: 14px;
      font-weight: 500;
      white-space: nowrap;
      box-shadow: 0 8px 32px rgba(26,24,20,0.4);
      display: flex;
      align-items: center;
      gap: 10px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.35s ease, transform 0.35s ease;
    }
    .toast-card.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    @media (max-width: 480px) {
      .restaurant-name { font-size: 26px; }
      .header-inner { padding: 16px 18px 14px; }
      .main { padding: 24px 18px 40px; }
      .item-img-wrap, .item-img-placeholder { width: 76px; height: 76px; }
      .cart-fab { min-width: 220px; padding: 14px 20px; }
      .spotlight-label { font-size: 13px; }
    }
  </style>
</head>
<body>

  <header class="header">
    <div class="header-inner">
      <div class="restaurant-name" id="restaurant-name">Carregando...</div>
      <div class="mesa-pill" id="mesa-pill">
        <div class="dot"></div>
        <span>Mesa <strong id="mesa-num">‚Äî</strong></span>
      </div>
    </div>
  </header>

  <div class="cat-nav-wrap" id="cat-nav-wrap" style="display:none;">
    <div class="cat-nav" id="cat-nav"></div>
  </div>

  <main class="main">
    <div class="state-box" id="loading-state">
      <div class="spinner"></div>
      <p>Carregando card√°pio...</p>
    </div>
    <div class="state-box" id="error-state" style="display:none;">
      <div class="icon">üòï</div>
      <p id="error-msg">Erro ao carregar card√°pio.</p>
    </div>
    <div id="cardapio-content" style="display:none;"></div>
  </main>

  <!-- CART FAB -->
  <button class="cart-fab hidden" id="cart-fab" onclick="openCart()">
    <div class="cart-fab-left">
      <span>üõí</span>
      <span class="cart-count-badge" id="cart-count">0</span>
      <span>Ver carrinho</span>
    </div>
    <span class="cart-fab-price" id="cart-fab-price">R$ 0,00</span>
  </button>

  <!-- üî¶ SPOTLIGHT -->
  <div class="spotlight-overlay hidden" id="spotlight-overlay"></div>
  <div class="spotlight-label hidden" id="spotlight-label">
    <span class="s-icon">üëÜ</span>
    Toque em uma categoria para ver os itens
  </div>

  <!-- üçû TOAST -->
  <div class="toast-card" id="toast-card">
    üõí Adicione ao carrinho e finalize o pedido
  </div>

  <!-- CART -->
  <div class="cart-backdrop" id="cart-backdrop" onclick="closeCart()"></div>
  <div class="cart-drawer" id="cart-drawer">
    <div class="cart-handle"></div>
    <div class="cart-header">
      <div class="cart-title">Seu pedido</div>
      <button class="cart-close" onclick="closeCart()">√ó</button>
    </div>
    <div class="cart-body" id="cart-body"></div>
    <div class="cart-footer">
      <div class="cart-total-row">
        <span class="cart-total-label">Total do pedido</span>
        <span class="cart-total-value" id="cart-total">R$ 0,00</span>
      </div>
      <button class="checkout-btn" onclick="openCheckout()">Continuar ‚Üí</button>
    </div>
  </div>

  <!-- CHECKOUT -->
  <div class="checkout-backdrop" id="checkout-backdrop" onclick="closeCheckout()"></div>
  <div class="checkout-modal" id="checkout-modal">
    <div class="checkout-handle"></div>
    <div class="checkout-title">Confirmar pedido</div>
    <div class="mesa-warning" id="mesa-warning" style="display:none;">
      <span class="warn-icon">üìç</span>
      <span id="mesa-warning-text"></span>
    </div>
    <div class="form-field">
      <label class="form-label">Seu nome</label>
      <input class="form-input" id="input-name" placeholder="Ex: Jo√£o Silva" />
    </div>
    <div class="form-field">
      <label class="form-label">Telefone</label>
      <input class="form-input" id="input-phone" type="tel" placeholder="(11) 99999-9999" inputmode="tel" />
    </div>
    <div class="form-field">
      <label class="form-label">Forma de pagamento</label>
      <select class="form-select" id="input-payment">
        <option value="">Selecione...</option>
        <option value="pix">PIX</option>
        <option value="credito">Cart√£o de cr√©dito</option>
        <option value="debito">Cart√£o de d√©bito</option>
        <option value="dinheiro">Dinheiro</option>
      </select>
    </div>
    <div class="order-summary" id="checkout-summary"></div>
    <button class="confirm-btn" id="confirm-btn" onclick="submitOrder()">Fazer pedido</button>
  </div>

  <!-- SUCCESS -->
  <div class="success-screen" id="success-screen">
    <div class="success-icon-wrap">‚úì</div>
    <div class="success-title">Pedido feito!</div>
    <div class="success-divider"></div>
    <p class="success-msg">Seu pedido foi enviado para a cozinha. Aguarde, logo estar√° pronto!</p>
    <div class="success-order" id="success-order-num"></div>
    <button class="success-back-btn" onclick="resetAll()">Fazer novo pedido</button>
  </div>

  <script>
    const API_BASE = 'https://kds-backend.dahead.easypanel.host';

    let restaurantId = null;
    let mesaNum = null;
    let cardapioItems = [];
    let cart = {};
    let tutorialDone = false;

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // üî¶ SPOTLIGHT
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function showSpotlight() {
      setTimeout(() => {
        const firstTitle = document.querySelector('.category-title');
        if (!firstTitle) return;

        const overlay = document.getElementById('spotlight-overlay');
        const label   = document.getElementById('spotlight-label');

        // Cria o "buraco" que ilumina a categoria
        const hole = document.createElement('div');
        hole.className = 'spotlight-hole';
        overlay.appendChild(hole);

        function positionHole() {
          const rect = firstTitle.getBoundingClientRect();
          const pad  = 10;
          hole.style.left   = (rect.left - pad) + 'px';
          hole.style.top    = (rect.top  - pad) + 'px';
          hole.style.width  = (rect.width  + pad * 2) + 'px';
          hole.style.height = (rect.height + pad * 2) + 'px';

          // Posiciona o label ABAIXO da categoria destacada
          const labelTop = rect.bottom + pad + 24;
          label.style.top = labelTop + 'px';
          label.style.bottom = 'auto';
        }

        positionHole();
        window.addEventListener('resize', positionHole, { passive: true });

        overlay.classList.remove('hidden');
        label.classList.remove('hidden');

        // Qualquer toque fora fecha
        overlay.addEventListener('click', dismissSpotlight, { once: true });

      }, 500);
    }

    function dismissSpotlight() {
      document.getElementById('spotlight-overlay').classList.add('hidden');
      document.getElementById('spotlight-label').classList.add('hidden');
    }

    function showToast() {
      if (tutorialDone) return;
      tutorialDone = true;
      const toast = document.getElementById('toast-card');
      toast.classList.add('show');
      setTimeout(() => {
        toast.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
        toast.classList.remove('show');
      }, 5000);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // INIT
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    async function init() {
      const params = new URLSearchParams(window.location.search);
      mesaNum = params.get('mesa') || null;

      if (mesaNum) {
        const pill = document.getElementById('mesa-pill');
        pill.style.display = 'inline-flex';
        document.getElementById('mesa-num').textContent = mesaNum;
      }

      try {
        const dominio = window.location.hostname;
        const resp = await fetch(`${API_BASE}/api/v1/dominio/${dominio}`);
        if (!resp.ok) throw new Error();
        const data = await resp.json();
        restaurantId = data.restaurant_id;
        await loadRestaurant();
        await loadCardapio();
      } catch {
        showError('Card√°pio n√£o encontrado. Verifique o link.');
      }
    }

    async function loadRestaurant() {
      try {
        const resp = await fetch(`${API_BASE}/api/v1/restaurante/${restaurantId}`);
        if (!resp.ok) return;
        const data = await resp.json();
        document.title = data.name || 'Card√°pio';
        document.getElementById('restaurant-name').textContent = data.name || 'Card√°pio';
      } catch { document.getElementById('restaurant-name').textContent = 'Card√°pio'; }
    }

    async function loadCardapio() {
      try {
        const resp = await fetch(`${API_BASE}/api/v1/cardapio/${restaurantId}`);
        if (!resp.ok) throw new Error();
        const data = await resp.json();
        cardapioItems = Array.isArray(data) ? data : [];
        if (!cardapioItems.length) { showError('Nenhum item no card√°pio ainda.'); return; }
        renderCardapio();
        showSpotlight(); // üî¶
      } catch { showError('Erro ao carregar card√°pio. Tente novamente.'); }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // RENDER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function renderCardapio() {
      document.getElementById('loading-state').style.display = 'none';
      document.getElementById('cardapio-content').style.display = 'block';
      document.getElementById('cat-nav-wrap').style.display = 'block';

      const categorias = {};
      cardapioItems
        .sort((a, b) => (a.ordem||0) - (b.ordem||0))
        .forEach(item => {
          const cat = item.categoria || 'Geral';
          if (!categorias[cat]) categorias[cat] = [];
          categorias[cat].push(item);
        });

      const catNav = document.getElementById('cat-nav');
      catNav.innerHTML = '';
      Object.keys(categorias).forEach((cat, i) => {
        const btn = document.createElement('button');
        btn.className = 'cat-btn' + (i === 0 ? ' active' : '');
        btn.textContent = cat;
        btn.onclick = () => {
          document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          document.getElementById(`cat-${slugify(cat)}`).scrollIntoView({ behavior: 'smooth', block: 'start' });
        };
        catNav.appendChild(btn);
      });

      const content = document.getElementById('cardapio-content');
      content.innerHTML = '';

      Object.entries(categorias).forEach(([cat, items], idx) => {
        const section = document.createElement('div');
        section.className = 'category-section'; // fechado por padr√£o
        section.id = `cat-${slugify(cat)}`;
        section.style.animationDelay = `${idx * 0.07}s`;

        const title = document.createElement('div');
        title.className = 'category-title';
        title.innerHTML = `
          <span class="category-title-text">${cat}</span>
          <span class="category-arrow">‚ñ∂</span>
        `;

        title.addEventListener('click', () => {
          dismissSpotlight(); // fecha spotlight se ainda aberto
          section.classList.toggle('open');
        });

        const grid = document.createElement('div');
        grid.className = 'items-grid';
        items.forEach(item => grid.appendChild(buildItemCard(item)));

        section.appendChild(title);
        section.appendChild(grid);
        content.appendChild(section);
      });
    }

    function buildItemCard(item) {
      const card = document.createElement('div');
      card.className = 'item-card' + (!item.ativo ? ' inactive' : '');
      card.id = `item-card-${item.id}`;
      const inCart = cart[item.id];

      card.innerHTML = `
        ${item.foto_url
          ? `<div class="item-img-wrap"><img class="item-img" src="${item.foto_url}" alt="${escHtml(item.nome)}" loading="lazy"/></div>`
          : `<div class="item-img-placeholder">üçΩÔ∏è</div>`}
        <div class="item-info">
          <div class="item-name">${escHtml(item.nome)}</div>
          ${item.descricao ? `<div class="item-desc">${escHtml(item.descricao)}</div>` : ''}
          <div class="item-footer">
            <div class="item-price">${formatCurrency(item.preco)}</div>
            ${!item.ativo
              ? `<span class="item-inactive-tag">Indispon√≠vel</span>`
              : inCart
                ? `<div class="item-counter">
                    <button class="counter-btn" onclick="changeQty('${item.id}',-1,event)">‚àí</button>
                    <span class="counter-qty">${inCart.qty}</span>
                    <button class="counter-btn" onclick="changeQty('${item.id}',1,event)">+</button>
                   </div>`
                : `<button class="add-btn" onclick="addToCart('${item.id}',event)">+</button>`}
          </div>
        </div>`;
      return card;
    }

    function refreshItemCard(itemId) {
      const item = cardapioItems.find(i => i.id === itemId);
      if (!item) return;
      const old = document.getElementById(`item-card-${itemId}`);
      if (old) old.replaceWith(buildItemCard(item));
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // CART
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function addToCart(itemId, e) {
      if (e) e.stopPropagation();
      const item = cardapioItems.find(i => i.id === itemId);
      if (!item) return;
      cart[itemId] = { item, qty: 1 };
      refreshItemCard(itemId);
      updateCartUI();
      showToast(); // passo 2
    }

    function changeQty(itemId, delta, e) {
      if (e) e.stopPropagation();
      if (!cart[itemId]) return;
      cart[itemId].qty += delta;
      if (cart[itemId].qty <= 0) delete cart[itemId];
      refreshItemCard(itemId);
      updateCartUI();
    }

    function updateCartUI() {
      const items      = Object.values(cart);
      const totalQty   = items.reduce((s,c) => s + c.qty, 0);
      const totalPrice = items.reduce((s,c) => s + c.qty * parseFloat(c.item.preco||0), 0);
      const fab = document.getElementById('cart-fab');
      if (!totalQty) { fab.classList.add('hidden'); }
      else {
        fab.classList.remove('hidden');
        document.getElementById('cart-count').textContent = totalQty;
        document.getElementById('cart-fab-price').textContent = formatCurrency(totalPrice);
      }
      renderCartBody();
      document.getElementById('cart-total').textContent = formatCurrency(totalPrice);
    }

    function renderCartBody() {
      const body  = document.getElementById('cart-body');
      const items = Object.values(cart);
      if (!items.length) {
        body.innerHTML = `<div class="cart-empty"><div class="icon">üõí</div><p>Seu carrinho est√° vazio</p></div>`;
        return;
      }
      body.innerHTML = items.map(({item,qty}) => `
        <div class="cart-item">
          <div class="cart-item-name">${escHtml(item.nome)}</div>
          <div class="cart-item-qty">
            <button class="cart-qty-btn" onclick="changeQty('${item.id}',-1)">‚àí</button>
            <span class="cart-qty-num">${qty}</span>
            <button class="cart-qty-btn" onclick="changeQty('${item.id}',1)">+</button>
          </div>
          <div class="cart-item-price">${formatCurrency(qty * parseFloat(item.preco||0))}</div>
        </div>`).join('');
    }

    function openCart() {
      document.getElementById('cart-backdrop').classList.add('open');
      document.getElementById('cart-drawer').classList.add('open');
      renderCartBody();
    }
    function closeCart() {
      document.getElementById('cart-backdrop').classList.remove('open');
      document.getElementById('cart-drawer').classList.remove('open');
    }

    function openCheckout() {
      closeCart();
      const warning = document.getElementById('mesa-warning');
      document.getElementById('mesa-warning-text').textContent = mesaNum ? `Seu pedido ser√° feito na Mesa ${mesaNum}.` : '';
      warning.style.display = mesaNum ? 'flex' : 'none';

      const items = Object.values(cart);
      const total = items.reduce((s,c) => s + c.qty * parseFloat(c.item.preco||0), 0);
      document.getElementById('checkout-summary').innerHTML = `
        <div class="order-summary-title">Resumo do pedido</div>
        ${items.map(({item,qty}) => `
          <div class="order-summary-item">
            <span>${qty}√ó ${escHtml(item.nome)}</span>
            <span>${formatCurrency(qty * parseFloat(item.preco||0))}</span>
          </div>`).join('')}
        <div class="order-summary-total">
          <span>Total</span><span>${formatCurrency(total)}</span>
        </div>`;
      document.getElementById('checkout-backdrop').classList.add('open');
      document.getElementById('checkout-modal').classList.add('open');
    }
    function closeCheckout() {
      document.getElementById('checkout-backdrop').classList.remove('open');
      document.getElementById('checkout-modal').classList.remove('open');
    }

    async function submitOrder() {
      const name    = document.getElementById('input-name').value.trim();
      const phone   = document.getElementById('input-phone').value.trim();
      const payment = document.getElementById('input-payment').value;
      if (!name)    { alert('Por favor, informe seu nome.'); document.getElementById('input-name').focus(); return; }
      if (!payment) { alert('Por favor, selecione a forma de pagamento.'); return; }

      const items = Object.values(cart);
      const total = items.reduce((s,c) => s + c.qty * parseFloat(c.item.preco||0), 0);
      const itens = items.map(({item,qty}) => ({
        name: item.nome, qty, quantidade: qty,
        price: parseFloat(item.preco||0), preco: parseFloat(item.preco||0)
      }));

      const btn = document.getElementById('confirm-btn');
      btn.disabled = true;
      btn.textContent = 'Enviando...';

      try {
        const resp = await fetch(`${API_BASE}/api/v1/pedidos`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            restaurant_id: restaurantId,
            client_name: name,
            client_phone: phone || null,
            itens, total_price: total,
            service_type: 'local',
            payment_method: payment,
            origin: 'autoatendimento',
            notes: mesaNum ? `Mesa ${mesaNum}` : ''
          })
        });
        const data = await resp.json();
        if (!resp.ok) throw new Error(data.error || 'Erro ao criar pedido');
        closeCheckout();
        showSuccess(data.order?.order_number);
      } catch(e) {
        alert('Erro ao enviar pedido.\n' + e.message);
        btn.disabled = false;
        btn.textContent = 'Fazer pedido';
      }
    }

    function showSuccess(orderNum) {
      document.getElementById('success-order-num').textContent = orderNum ? `Pedido #${orderNum}` : 'Pedido confirmado';
      document.getElementById('success-screen').classList.add('open');
    }

    function resetAll() {
      cart = {};
      tutorialDone = false;
      document.getElementById('success-screen').classList.remove('open');
      document.getElementById('input-name').value = '';
      document.getElementById('input-phone').value = '';
      document.getElementById('input-payment').value = '';
      const toast = document.getElementById('toast-card');
      toast.classList.remove('show');
      updateCartUI();
      renderCardapio();
      showSpotlight();
    }

    function showError(msg) {
      document.getElementById('loading-state').style.display = 'none';
      document.getElementById('error-state').style.display = 'flex';
      document.getElementById('error-msg').textContent = msg;
    }

    function formatCurrency(v) {
      return new Intl.NumberFormat('pt-BR', { style:'currency', currency:'BRL' }).format(v||0);
    }
    function escHtml(str) {
      return String(str||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }
    function slugify(str) {
      return String(str||'').toLowerCase().replace(/\s+/g,'-').replace(/[^\w-]/g,'');
    }

    init();
  </script>
</body>
</html>
